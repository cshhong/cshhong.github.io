<html>
<head>
    <title>Reinforcement Learning as Probabilistic Inference - Part 1</title>
    <meta charset='UTF-8'>
    <meta content='width=device-width, initial-scale=1' name='viewport'/>

    <meta name='description' content='Gregory Gundersen is a PhD candidate at Princeton.'>
    <meta name='keywords' content='blogging, writing'>
    <meta name='author' content='Gregory Gundersen'>

    <link href='/css/blog.css' rel='stylesheet'/>
    <link href='/css/trac.css' rel='stylesheet'/>
    <link href='/css/markdown.css' rel='stylesheet'/>

    <!-- <script type='text/x-mathjax-config'>
MathJax.Hub.Config({
  jax: ['input/TeX', 'output/HTML-CSS'],
  tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
    extensions: ['color.js']

  },
  messageStyle: 'none',
  'HTML-CSS': { preferredFont: 'TeX', availableFonts: ['STIX','TeX'] }
});
</script>

<script type="text/javascript" id="MathJax-script" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.0.0/es5/latest?tex-mml-chtml.js">
</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous"> -->

<!-- use katex only -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/auto-render.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  renderMathInElement(document.body, {
    delimiters: [
                { left: "$", right: "$", display: false },     // Inline math with $
                { left: "\\(", right: "\\)", display: false }, // Inline math with \(
                { left: "$$", right: "$$", display: true },    // Block math with $$
                { left: "\\[", right: "\\]", display: true }   // Block math with \[
              ]
  });
});
</script>
</head>
<body>
<div class='content'>
    <div class='nav'>
    <ul class='wrap'>
        <li><a href='/'>Home</a></li>
        <li><a href='/blog'>Blog</a></li>
        <li><a href='/feed.xml'>RSS</a></li>
    </ul>
</div>
    <div class='front-matter'>
        <div class='wrap'>
            <h1>Reinforcement Learning as Probabilistic Inference - Part 1</h1>
            <h4>This is a series of posts to formalize the underlying similarities in algorithms for Reinforcement Learning (RL) and Generative Models (GMs), which on the surface have distinct formulations for tasks of different nature and explore their integration. The long term goal is to take the best of the two frameworks for decision making in physical environments. For instance, can we generate policies that are adaptable and generalizeable, without having to collect large corpus of data particular to the task, while building on foundation models, now prevalently trained as generative models.</h4>
            <div class='bylines'>
                <div class='byline'>
                    <h3>Published</h3>
                    <p>29 November 2024</p>
                </div>
            </div>
            <div class='clear'></div>
        </div>
    </div>
    <div class='wrap article'>
        
<h2 id="the-best-of-both-worlds">The Best of Both Worlds</h2>
<p>While <strong>Reinforcement Learning (RL)</strong> isn’t necessarily coined as <em>generative</em>, and it is not developed for <em>generative</em> tasks, it is used to <strong>generate policies that are adaptable and generalizeable to unseen situations</strong>. It is an agentic frame for solving decision making problems that does not require data apriori but the agent goes through trial and error while interacting with the environment. In this process, a policy, a mapping from state to action, that would maximize the expected cumulative rewards, which typically aligns with the given task across the trajectory, is learned. The premise is there is a dynamic of the environment, and some kind of decision making in that environment of which one is better than the other. Through the agent interactions, the dynamics and policy are learned simultaneously <em>(model-based RL make the learning of the dynamics explicit, while for model-free RL, the learning of the dynamics is implied in the direct policy learning)</em>.</p>

<p>On the other hand, <strong>Generative Models (GMs)</strong> are commonly trained with <strong>supervised-learning, where the model is learning a probablistic distribution from existing data</strong>. The hope is that samples from this trained distribution align with the underlying features of the existing data i.e. <em>looks like an image in the real world</em>, while not being directly from the existing data, but can also align with the task i.e. <em>generate an image that aligns with the text prompt</em>.</p>

<p>At this point, many advancements of GMs are being made by building on top of foundation models which are trained on a corpus of data with a lot of compute. Prompting, finetuning models is all a natural path because the problems are framed as probabilistic models to start with, and methods of conditioning and inference from such models are well known. On the otherhand, RL, by its nature of learning a decision making policy, has potential to be adaptable and generalizeable to unseen variations of the task. This has been explored with a certain suite of tasks such as robotic control, games, but recent works have questioned its robustness  <a class="citation" href="#benjaminsContextualizeMeCase2023">[1]</a> expecially for tasks beyond the conventional realm <a class="citation" href="#choModelBasedTransferLearning2024a">[2]</a>. These works show that RL algorithms have overfitted such well-known tasks and it is still apparent that for custom task the approach of training proprietary environments from scratch is still common. One explanation for this is that RL is striving to solve a much harder task; <em>making a sequence of decisions to reach a goal</em> vs <em>emulating a goal</em>. This requires the learning of both the dynamics of the environment relative to the task, and finding the best decisions to make which the approach of supervised-learning on existing data is not readily applicable.</p>

<h2 id="how-can-rl-and-gms-relate">How can RL and GMs relate?</h2>
<p>Some characteristics of RL and GMs that I find to relate to each other:</p>

<p>RL shares a similar frame of making sequential predictions while referring to previous states with autoregressive transformers which have advanced GMs significantly. Although the difference is that the mechanism of RL is based on <strong>look-ahead approximations</strong>  as opposed to <strong>tokens and attention</strong> used in transformers.</p>

<figure class="figure-container">
  <div class="image-wrapper">
    <img src="/assets/images/blog_posts/2024-11-29-RL/lookahead_qvalue.png" alt="QValue" style="width: 100%; max-width: 300px; height: auto;" />
    <img src="/assets/images/blog_posts/2024-11-29-RL/transformer_explained.png" alt="Transformer" style="width: 100%; max-width: 350px; height: auto;" />
  </div>
  <figcaption class="caption">
    (Left) The Q-function used in RL (1) looks at all possible next states that lie one step ahead and (2) looks at the best possible action from the current state to that next state. The figure shows the Q-function for a grid world problem with blocking states (black), where the goal is the bottom right corner. The four matrices show the reward (or Q-values of the Q-function) for all four actions in each state. <a class="citation" href="#DeepLearningNutshell2016">[3]</a>  (Right) An illustration of How attention can be allocated across different regions (tokens) in an image. To the left is shown the dimension that encodes number of animal heads. To the right is shown a different dimension that encodes color (or this could be three dimensions, coding RGB). The output token is a weighted sum over all the tokens attended to. <a class="citation" href="#torralbaFoundationsComputerVision2024">[4]</a>
  </figcaption>
</figure>

<p>Diffusion models also share the underlying idea of RL that factorizes a complex problem into smaller sequential steps in time by leveraging the premise of the <strong>Markov Decision Process (MDP)</strong> where the current state conditions on the previous state.</p>
<figure class="figure">
  <img src="/assets/images/blog_posts/2024-11-29-RL/Markov_Decision_Process.svg" alt="Markov_Decision_Process" style="width: 70%; max-width: 600px; height: auto;" />
  <figcaption class="caption">Example of a simple MDP with three states (green circles) and two actions (orange circles), with two rewards (orange arrows) <a class="citation" href="#img_MarkovDecisionProcess">[5]</a></figcaption>
</figure>

<p>For both approaches, what is learned in the end are <strong>parameterized distributions</strong>. While RL does not require data upfront, each trial-and-error of the agent within the environment equates to a training data instance in supervised learning, so in a sense it is generating training data as it goes. <strong>Reward signals</strong> used within the training of RL agents, can be equated to the <strong>conditioning</strong> of a trained GMs for a specific outcome. The difference is that with RL the distribution being trained is a <strong>distribution of trajectories</strong>, from which we can derive a promising policy, and GMs learn <strong>distributions of generated instances</strong>.</p>

<h2 id="why-do-we-want-to-formally-connect-rl-and-gm">Why do we want to formally connect RL and GM?</h2>

<p>The ultimate goal of RL is to estimate stationary policies or single-step models. <strong>We want to explore the possibility of reframing decision making problems, especially those that are across a temporal sequence, to be solved with probabilistic distribution matching frames that have successfully trained GMs.</strong> The connection between reinforcement learning and inference in probabilistic models is not obvious. However, <strong>formalizing a sequential decision making problem as probabilistic inference</strong> in principle allows us to bring to bear a wide array of approximate inference tools, extend the model in flexible and powerful ways, and reason about compositionality and partial observability <a class="citation" href="#levineReinforcementLearningControl2018">[6]</a>. Especially with the advent of high-capacity sequence prediction models that work well in other domains, such as natural-language processing, formulating the task with probabilistic modeling has become very promising.</p>

<p>More specifically, probablistic modeling can allow us to break away from the restrictive structure of RL. A strong underlying causal structure of the trajectory data in RL is that the dynamic is Markovian; the current state relies only on the previous state. While this structure is the backbone of RL which allows for optimization with theoretical guarentees, it is often the case that it is more advantageous to employ various structures that are not only causal (where the current state depends on the previous state) but also anti-causal (where the current state depends on the future state). Ideally, we would want the flexibility to use structured information that better fit the objective of the task i.e. planning, and also perform better on sparse reward, long horizon tasks where the local structure of the MDP is insufficient. Research in the RL community have extensively explored this, but in its current state methods are not easy to implement, requiring extensive tuning to the task. <strong>The expectation is if we can frame and solve such tasks as a probablistic models, not only would we be able to take advantage of causal and anti-causal structure more flexibly, but we can also leverage existing foundation models to solve complex decision-making problems that were difficult to solve with only RL</strong>.</p>

<h2 id="formulate-decision-making-as-a-probabilistic-graphical-model">Formulate decision making as a Probabilistic Graphical Model</h2>
<p>Decision making problems (formalized as RL or optimal control), can be viewed as a generalized Probabilistic Graphical Model (PGM) augmented with utilities or rewards, that are viewed as extrinsic signals. In solving these problems, one common approach is to model the underlying dynamics as a probabilistic model e.g. with model-based RL, and in a distinct process, e.g. trajectory optimization  an optimal plan or a policy is determined.</p>

<h3 id="what-are-probabilistic-graphical-models-pgms-and-why-do-we-want-to-use-them">What are Probabilistic Graphical Models (PGMs) and why do we want to use them?</h3>
<p>Probabilistic graphical models use a graph-based representation as the basis for compactly encoding a complex distribution over a high-dimensional space. In this graphical representation, illustrated in figure *, the nodes (or ovals) correspond to the variables in our domain, and the edges correspond to direct probabilistic interactions between them.</p>
<figure class="figure">
  <img src="/assets/images/blog_posts/2024-11-29-RL/PGMdefine.png" alt="Example description" style="width: 100%; max-width: 600px; height: auto;" />
  <figcaption class="caption">Figure 1: Different perspectives on probabilistic graphical models: top — the graphical representation; middle — the independencies induced by the graph structure; bottom — the factorization induced by the graph structure. (a) A sample Bayesian network. (b) A sample Markov network.</figcaption>
</figure>

<p>In the framework of PGMs, it is sufficient to write down the model and pose the question, and the objectives for learning and inference emerge automatically.</p>

<p>Conventionally, determining an optimal course of action (a plan) or an optimal decision-making strategy (a policy) is considered a fundamentally distinct type of problem than probabilistic inference, although the underlying dynamical system might still be described by a probabilistic graphical model.</p>

<h2 id="references">References</h2>
<ol class="bibliography"><li><span id="benjaminsContextualizeMeCase2023">[1]C. Benjamins <i>et al.</i>, “Contextualize Me – The Case for Context in Reinforcement Learning,” 2023.</span></li>
<li><span id="choModelBasedTransferLearning2024a">[2]J.-H. Cho, V. Jayawardana, S. Li, and C. Wu, “Model-Based Transfer Learning for Contextual Reinforcement Learning,” 2024.</span></li>
<li><span id="DeepLearningNutshell2016">[3]“Deep Learning in a Nutshell: Reinforcement Learning,” <i>NVIDIA Technical Blog</i>. https://developer.nvidia.com/blog/deep-learning-nutshell-reinforcement-learning/, 2016.</span></li>
<li><span id="torralbaFoundationsComputerVision2024">[4]A. Torralba, <i>Foundations of Computer Vision</i>. Cambridge, Massachusetts: The MIT Press, 2024.</span></li>
<li><span id="img_MarkovDecisionProcess">[5]waldoalvarez, “Own work.” 2017, [Online]. Available at: https://commons.wikimedia.org/w/index.php?curid=59364518.</span></li>
<li><span id="levineReinforcementLearningControl2018">[6]S. Levine, “Reinforcement Learning and Control as Probabilistic Inference: Tutorial and Review,” 2018.</span></li></ol>


    </div>
    <div id='bibliography'>
        <div class='wrap'>
            <ol class="bibliography"></ol>
        </div>
    </div>
</div>
</body>
</html>